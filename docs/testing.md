# テスト項目ドキュメント

本文書は、`prompt-bom` CLIツールのテスト項目について記述します。

## テストの目的

CLIの各コマンド (`init`, `validate`, `build`) が仕様通りに動作することを確認し、品質を担保することを目的とします。
主要な正常系および代表的な異常系のシナリオをカバーします。

## テスト実行方法

プロジェクトルートディレクトリで以下のコマンドを実行します。

```bash
go test ./cmd/... -cover
```

これにより、`cmd/bom` パッケージ以下のテストが実行され、カバレッジレポートが出力されます。

## テスト対象と主な検証ケース

テストは `cmd/bom/` ディレクトリ以下の `_test.go` ファイルに実装されています。

### `bom init` (`init_test.go`)

- **テスト関数**: `TestInitCmd`
- **主な検証ケース**:
    - `デフォルト出力`: 引数なしで実行し、`prompt.bom.yaml` がデフォルトテンプレート内容で生成されることを確認。
    - `出力ファイル指定`: `--output` フラグで指定したファイル名 (`custom.init.yaml`) でファイルが生成されることを確認。

### `bom validate` (`validate_test.go`)

- **テスト関数**: `TestValidateCmd`
- **主な検証ケース**:
    - `有効なYAML`: スキーマに準拠した有効なYAMLファイルを指定した場合、エラーが発生しないことを確認。
    - `無効なYAML (必須フィールド欠落)`: 必須フィールド (`bom.name`) が欠落したYAMLファイルを指定した場合、「bom.name is required」を含むエラーが発生することを確認。
    - `存在しないファイル`: 存在しないYAMLファイルを指定した場合、「YAMLパースエラー: open ... no such file or directory」を含むエラーが発生することを確認。

### `bom build` (`build_test.go`)

- **テスト関数**: `TestBuildCmdDirectly`
- **主な検証ケース**:
    - `有効なBOMをファイルに出力`: 有効なBOMファイル (`A`, `C` を参照) と `--output` フラグを指定した場合、指定したファイルに `A` と `C` のプロンプト内容が順番通りに結合されて出力されることを確認。
    - `存在しないコンポーネント参照`: 存在しないコンポーネント (`D`) を参照するBOMファイルを指定した場合、「コンポーネントファイル読み込み失敗」を含むエラーが発生することを確認。
    - `存在しないBOMファイル`: 存在しないBOMファイルを指定した場合、「BOM読み込みエラー: open ... no such file or directory」を含むエラーが発生することを確認。
    - (テスト内部では `A.md`, `C.md` が一時的に生成されます)

## 現在のカバレッジ

`go test ./cmd/... -cover` 実行時のカバレッジ:

```
ok      github.com/kannazuki/prompt-bom/cmd/bom [...]  coverage: 82.6% of statements
```

目標の70%を達成しています。 